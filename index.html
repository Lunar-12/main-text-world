<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cross-Device Saving Textboxes</title>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    .tiny-textbox {
      width: 12px;
      height: 12px;
      font-size: 10px;
      font-family: 'Press Start 2P', monospace;
      padding: 0;
      border: 1px solid #ccc;
      margin: 1px;
      display: inline-block;
      background-color: #f0f0f0;
    }
    .line {
      display: flex;
    }
  </style>
</head>
<body>
  <div id="text-boxes-container"></div>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
  apiKey: "AIzaSyB2waO_a9qS9h70An6WYJCtUjBETPHWYlU",
  authDomain: "adada-c3f5e.firebaseapp.com",
  projectId: "adada-c3f5e",
  storageBucket: "adada-c3f5e.firebasestorage.app",
  messagingSenderId: "769471205267",
  appId: "1:769471205267:web:c409ef3ddbe8d789702266",
  measurementId: "G-0RV4PPLSZZ"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Global variables for grid size
    let numCols, numRows;

    // Generate textboxes and sync with Firebase
    async function createTextBoxes() {
      const container = document.getElementById('text-boxes-container');
      container.innerHTML = '';
      numCols = Math.floor(window.innerWidth / 14);
      numRows = Math.floor(window.innerHeight / 14);

      const gridData = await fetchGridData();

      for (let row = 0; row < numRows; row++) {
        const line = document.createElement('div');
        line.className = 'line';
        container.appendChild(line);

        for (let col = 0; col < numCols; col++) {
          const textbox = document.createElement('input');
          textbox.type = 'text';
          textbox.className = 'tiny-textbox';
          textbox.maxLength = 1;

          // Load saved text if available
          const key = `${row}_${col}`;
          textbox.value = gridData[key] || '';

          // Save text to Firebase on input
          textbox.addEventListener('input', () => {
            saveToFirebase(row, col, textbox.value);

            // Move to the next textbox when filled
            if (textbox.value.length === textbox.maxLength) {
              moveToNextTextbox(row, col);
            }
          });

          // Handle backspace navigation
          textbox.addEventListener('keydown', (event) => {
            if (event.key === 'Backspace' && textbox.value === '') {
              moveToPreviousTextbox(row, col);
            }
          });

          line.appendChild(textbox);
        }
      }
    }

    // Fetch saved grid data from Firebase
    async function fetchGridData() {
      const doc = await db.collection('grids').doc('default').get();
      return doc.exists ? doc.data() : {};
    }

    // Save a single cell's data to Firebase
    function saveToFirebase(row, col, value) {
      const key = `${row}_${col}`;
      db.collection('grids').doc('default').set(
        { [key]: value },
        { merge: true } // Merge with existing data
      );
    }

    // Move to the next textbox
    function moveToNextTextbox(row, col) {
      const nextIndex = row * numCols + col + 1;
      const textboxes = document.getElementsByClassName('tiny-textbox');
      if (nextIndex < textboxes.length) {
        textboxes[nextIndex].focus();
      }
    }

    // Move to the previous textbox
    function moveToPreviousTextbox(row, col) {
      const prevIndex = row * numCols + col - 1;
      const textboxes = document.getElementsByClassName('tiny-textbox');
      if (prevIndex >= 0) {
        textboxes[prevIndex].focus();
      }
    }

    // Recreate grid on window resize
    window.onresize = createTextBoxes;

    // Initialize grid on page load
    window.onload = createTextBoxes;
  </script>
</body>
</html>
